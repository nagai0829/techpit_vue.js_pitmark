{"filter":false,"title":"UserService.js","tooltip":"/app/pitmark/src/services/UserService.js","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":22,"column":23},"action":"insert","lines":["import gravatar from \"gravatar\";","import firebase from \"./firebase\";","","class UserService {","  constructor() {","    this.db = firebase.firestore();","  }","","  async createUser(auth) {","    // 作成したコレクションに合わせてオブジェクトを作成する","    const user = {","      authId: auth.uid,","      name: auth.email.substr(0, auth.email.indexOf(\"@\")),","      gravatarUrl: gravatar.url(auth.email)","    };","    // users コレクションに登録する","    await this.db.collection(\"users\").add(user);","    return user;","  }","}","","const userService = new UserService();","export { userService };"],"id":1}],[{"start":{"row":6,"column":3},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]},{"start":{"row":7,"column":2},"end":{"row":8,"column":0},"action":"insert","lines":["",""]},{"start":{"row":8,"column":0},"end":{"row":8,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":8,"column":2},"end":{"row":27,"column":3},"action":"insert","lines":["// 現在のユーザーを取得する","  async getCurrentUser() {","    // サインインしていることが前提なのでサインインしていない場合はエラーとする","    if (this.auth.currentUser == null) {","      throw new Error(\"サインインしていません。サインインしてください\");","    }","","    // Firestore からユーザーのデータを取得する","    const snapshot = await this.db","      .collection(\"users\")","      .where(\"authId\", \"==\", this.auth.currentUser.uid)","      .get();","    // Firestore のデータからユーザーオブジェクトを作成する","    let user = null;","    snapshot.forEach(doc => {","      user = doc.data();","      user.id = doc.id;","    });","    return user;","  }"],"id":3}]]},"ace":{"folds":[],"scrolltop":168,"scrollleft":0,"selection":{"start":{"row":27,"column":3},"end":{"row":27,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1614485241617,"hash":"43119d4817ef67c205134bc3e1323094f9dcf49c"}